<% width = '98%' %>
<% class_name = @object.class.name.downcase %>
<% form_name = "#{class_name}_#{@object.id}_comment_#{@position}_form" %>
<%= form_tag add_comment_comments_path(:class_id => @object.id, :class_name => @object.class, :position => @position), :remote => true, :id => form_name do %>
<p>
  <%= hidden_field_tag :position, @position %>
  <%= text_area_tag "#{class_name}[#{@object.id}][comment][#{@position}]", '', :name => 'comment', :rows => 2, :style => "width:#{width}" %>
  <%= link_to_function image_tag('contour/addfile.png', :alt => '') + 'Add Comment', "$.post($(\"##{form_name}\").attr(\"action\"), $(\"##{form_name}\").serialize(), null, \"script\");", :class => "button positive" %>
</p>
<% end %>
<br />

<%# @object.comments(@limit).each do |comment| %>
<% @comments.each do |comment| %>
  <div style="margin-bottom:5px" class="<%= 'recently_updated' if current_user.last_sign_in_at < comment.updated_at %>">
    <%= link_to comment.user.name, comment.user %>
    <span class="quiet small"><%= comment.friendly_date %></span>
    <% if current_user.all_movable_comments.include?(comment) %>
      <%= link_to image_tag('contour/open.png', :alt => ''), move_comment_path(comment) %>
    <% end %>
    <% if current_user.all_deletable_comments.include?(comment) %>
      <%= link_to image_tag('contour/delete.png', :alt => ''), comment, :confirm => "Are you sure you want to delete Comment #{comment.name}?", :method => :delete %>
    <% end %>
    <pre><%= comment.description %></pre>
  </div>
<% end %>

<center><%= paginate @comments %></center>