<% @title = "Project: #{@project.name}" %>
<h1>
  <table class="status-table">
    <tr>
      <td><%= @title %> &raquo;</td>
      <td style="vertical-align:top;padding:0 0 0 3px"><%= display_status(@project.status) %></td>
    </tr>
  </table>
</h1>

<%= link_to image_tag('icons/edit.png', :alt => '') + "Edit Project", edit_project_path(@project), :class => 'button' if current_user.all_projects.include?(@project) %>
<%= link_to image_tag('icons/mydocuments.png', :alt => '') + "View All Projects", projects_path, :class => 'button' %>
<% if current_user.all_projects.include?(@project) %>
  <%= link_to image_tag('icons/addfile.png', :alt => '') + "Create New Sticky", new_sticky_path(:sticky => {:project_id => @project.id}), :class => 'button positive' %>
  <%= link_to image_tag('icons/addfile.png', :alt => '') + "Create New Frame", new_frame_path(:frame => {:project_id => @project.id}), :class => 'button positive' %>
<% end %>

<div style="clear:both"></div>

<pre><%= @project.description %></pre>
<br />

<p>
  <b>Owner:</b>
  <%= link_to @project.user.name, @project.user %>
</p>

<% if false %>
<p>
  <b>Status:</b>
  <%= @project.status %>
</p>
<% end %>

<p>
  <b>Time Period:</b>
  <%= @project.start_date %> to <%= @project.end_date %>
</p>

<% ['editors', 'viewers'].each do |relation, allow_editing| %>
  <% @relation = relation; @allow_editing = allow_editing %>
  <% @users = User.current.order('last_name, first_name') %>
  <p>
    <div id="<%= @relation %>_list"><%= render :partial => 'project_users/index' %></div>
  </p>
<% end %>

<h2>Stickies</h2>

<div style="float:left">
  <%= form_tag search_stickies_path, :method => :get, :id => "stickies_search", :style => 'margin-bottom:0px' do %>
    <% if false %>  Search <%= text_field_tag 'search', params[:search] %> <% end %>
    <%= hidden_field_tag 'project_id', @project.id %>
    <%= link_to_function "&laquo;".html_safe, "decreaseSelectedIndex('#frame_id');", :style => 'text-decoration:none' %>
    <%= select_tag 'frame_id', options_for_select(@project.frames.collect{|f| [f.name, f.id]} + [['Backlog', 'backlog']], params[:frame_id]) %>
    <%= link_to_function "&raquo;".html_safe, "increaseSelectedIndex('#frame_id');", :style => 'text-decoration:none' %>
    <% if @frame %><br /><%= @frame.start_date %> to <%= @frame.end_date %> <% end %>
  <% end %>
</div>

<div id="stickies">
  <%#= render :partial => 'stickies/stickies' %>
  <div style="clear:both"></div><br /><br />
  <center><%= image_tag "ajax-loader.gif" %></center>
  <br /><br />
</div>

<div style="clear:both"></div>

<h2>General Project Comments</h2>
<div class="quiet">
  <%= image_tag('icons/information.png', :alt => '', :style => 'vertical-align:middle') %>
  Questions? Issues? Feature Requests? Bugs? Enter them here!
</div>
<br />
<% @object = @project %>
<% @limit = 5 %>
<% @position = ("%.6f" % Time.now.to_f).gsub('.','_') %>
<div id="<%= @object.class.name.downcase %>_<%= @object.id %>_comments_<%= @position %>" class = "comment_box">
  <%= render :partial => 'comments/index' %>
</div>

<% content_for :script do %>
  <%= javascript_tag do %>
    $(function(){
      $.get($("#stickies_search").attr("action"), $("#stickies_search").serialize(), null, "script");
    });
  <% end %>
<% end %>

<%#= render :partial => 'stickies/index' %>