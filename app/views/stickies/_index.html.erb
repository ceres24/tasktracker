<table width="100%">
  <tr>
    <th>ID</th>
    <th>Comments</th>
    <th>Name/Description</th>
    <th>Status</th>
    <th style="white-space:nowrap">Assigned To</th>
    <th style="white-space:nowrap">End Date</th>
    <th></th>
  </tr>

<% @project.stickies.order('completed, end_date DESC, start_date DESC').each do |sticky| %>
  <% @object = sticky %>
  <% @position = ("%.6f" % Time.now.to_f).gsub('.','_') %>
  <tbody>
    <tr>
      <td style="white-space:nowrap"><%= link_to sticky.name, sticky %></td>
      <td style="white-space:nowrap;text-align:center"><%= link_to_function "+ (#{sticky.comments.size})", "toggleSticky('##{@object.class.name.downcase}_#{@object.id}_comments_#{@position}');" %></td>
      <td><div style="width:400px"><pre class="collapsed" id="<%= @object.class.name.downcase %>_<%= @object.id %>_comments_<%= @position %>_description"><%= sticky.full_description %></pre></div></td>
      <td style="white-space:nowrap;vertical-align:middle"><%= display_completion(sticky.completed) %></td>
      <td style="white-space:nowrap;"><%= link_to sticky.owner.nickname if sticky.owner %></td>
      <td style="text-align:center"><% if false %><%= sticky.start_date %><br />to<br /><% end %><%= sticky.end_date %></td>
      <td style="vertical-align:middle"><%= link_to image_tag('gentleface/16/doc_edit.png', alt: ''), edit_sticky_path(sticky) if current_user.all_projects.include?(@project) %></td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td colspan="7">
        <div id="<%= @object.class.name.downcase %>_<%= @object.id %>_comments_<%= @position %>" style="display:none">
          <%= @comments = @object.comments.page(0).per(0); render partial: 'comments/index' %>
        </div>
      </td>
    </tr>
  </tbody>
<% end %>
</table>
