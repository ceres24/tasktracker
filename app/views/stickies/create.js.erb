$('#new-sticky-or-group-dialog').dialog('close');
$('#sticky_description').val('');
$('.field_with_errors').each( function() { $(this).removeClass('field_with_errors');});
<% unless @sticky.due_date.blank? %>

var tag_container = $("#day_<%= @sticky.due_date.strftime('%m_%d_%Y') %>_tag_container_<%= @sticky.tag_ids.sort.join('_') %>");

if(tag_container.length > 0){
  $(tag_container).append("<%= escape_javascript(render("stickies/popup")) %>")
}else{
  $("#day_<%= @sticky.due_date.strftime('%m_%d_%Y') %>").append("<div style='padding-bottom:5px' id='day_<%= @sticky.due_date.strftime('%m_%d_%Y') %>_tag_container_<%= @sticky.tag_ids.sort.join('_') %>'><%= @tags = @sticky.tags; escape_javascript(render("tags/small_tags")) %><%= escape_javascript(render("stickies/popup")) %></div>")
}

  $("#sticky_<%= @sticky.id %>_popup").effect("highlight", {}, 3000);
<% end %>
$(".project_<%= @sticky.project.id %>_color").css('color', '<%= @sticky.project.color(current_user) %>');


// Following copied from calendar.js.erb
$(".sticky_popup").each( function(index, element) {
  $(element).qtip({
    content:{
      text: '<div id="' + element.id + '_text"><center><%= image_tag 'ajax-loader.gif', alt: '' %></center></div>',
      ajax: {
        url: $(element).attr('rel'),
        type: 'POST',
        success: function(data, status) {
          eval(data);
        }
      },
      title:{
        text: $(element).attr('data-title')
      }
    },
    show:{
      event: 'mouseenter'
    },
    hide: {
      event: 'mouseleave'
    },
    position:{
      my: 'left top',
      at: 'right center',
      viewport: $(window)
    },
    style:{
      classes: 'ui-tooltip-shadow ui-tooltip-yellow'
    }
  });
  $(element).draggable({ revert: 'invalid', helper: "clone" });
});
