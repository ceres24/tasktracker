<% if params[:direction].to_i > 0 %>
  $("#month-breakdown").hide( 'slide', { direction: "left" }, 500 );
  $("#month-breakdown").html("<%= escape_javascript(render("stickies/month_breakdown")) %>");
  $("#month-breakdown").show( 'slide', { direction: "right" }, 500 );
<% elsif params[:direction].to_i < 0 %>
  $("#month-breakdown").hide( 'slide', { direction: "right" }, 500 );
  $("#month-breakdown").html("<%= escape_javascript(render("stickies/month_breakdown")) %>");
  $("#month-breakdown").show( 'slide', { direction: "left" }, 500 );
<% else %>
  $("#month-breakdown").html("<%= escape_javascript(render("stickies/month_breakdown")) %>");
<% end %>

$("#calendar-title").html("<%= escape_javascript(render("calendar_title")) %>");

$("#direction").val(0);

$('#month-breakdown').qtip('destroy');

<% if projects = Project.where(id: @stickies.uniq.pluck(:project_id)).order(:name) and projects.size > 0 %>

  <% projects.each do |project| %>
    $(".project_<%= project.id %>_color").css('color', '<%= project.color(current_user) %>');
  <% end %>

  $('#month-breakdown')
    .qtip({
      content:{
        text: '<%== escape_javascript((
          projects.collect{|project| "<span style=\"color: #{project.color(current_user)}\" class=\"project_#{project.id}_color\">#{project.name}<span>"}.join(' <span class="quiet">-</span> ')
        ).html_safe) %>',
        title:{
          text: 'Projects'
        }
      },
      show:{
        event: 'mouseenter'
      },
      hide: {
        event: 'mouseleave'
      },
      position:{
        my: 'top right',
        at: 'bottom right',
        viewport: $(window)
      },
      style:{
        classes: 'ui-tooltip-shadow ui-tooltip-light',
        tip:{
          width: 80
        }
      }
    });
<% end %>

$(".sticky_popup").each( function(index, element) {
  $(element).qtip({
    content:{
      text: '<div id="' + element.id + '_text"><center><%= image_tag 'ajax-loader.gif', alt: '' %></center></div>',
      ajax: {
        url: $(element).attr('rel'),
        type: 'POST',
        success: function(data, status) {
          eval(data);
        }
      },
      title:{
        text: $(element).attr('data-title')
      }
    },
    show:{
      event: 'mouseenter'
    },
    hide: {
      event: 'mouseleave'
    },
    position:{
      my: 'left center',
      at: 'right center',
      viewport: $(window)
    },
    style:{
      classes: 'ui-tooltip-shadow ui-tooltip-yellow'
    }
  });
});
